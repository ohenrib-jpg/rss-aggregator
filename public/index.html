<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgrÃ©gateur RSS Intelligent</title>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f8fafc; color: #1e293b; line-height: 1.6; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        /* Header */
        .header { background: white; padding: 20px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .header h1 { color: #1e40af; font-size: 2.5rem; margin-bottom: 10px; }
        
        /* Navigation */
        .tabs { display: flex; background: white; border-radius: 12px; padding: 5px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .tab { flex: 1; padding: 15px 20px; border: none; background: transparent; cursor: pointer; border-radius: 8px; font-size: 1rem; font-weight: 500; transition: all 0.3s ease; }
        .tab:hover { background: #f1f5f9; }
        .tab.active { background: #3b82f6; color: white; }
        
        /* Contenu */
        .tab-content { display: none; background: white; border-radius: 12px; padding: 30px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .tab-content.active { display: block; }
        
        /* Boutons */
        .btn { padding: 12px 24px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: 500; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 8px; }
        .btn-success { background: #10b981; color: white; }
        .btn-success:hover { background: #059669; }
        .btn-info { background: #3b82f6; color: white; }
        .btn-info:hover { background: #2563eb; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-secondary:hover { background: #4b5563; }
        .btn-warning { background: #f59e0b; color: white; }
        .btn-warning:hover { background: #d97706; }
        .btn-danger { background: #ef4444; color: white; }
        .btn-danger:hover { background: #dc2626; }
        
        /* Cartes */
        .card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .full-width { width: 100%; }
        
        /* Messages */
        #messageContainer { margin-bottom: 20px; }
        
        /* Loading */
        .loading { text-align: center; padding: 40px 20px; color: #64748b; }
        
        /* Panneau de contrÃ´le */
        .control-panel { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 25px; border-radius: 12px; margin-bottom: 20px; }
        
        /* Articles */
        .article-card { border: 1px solid #e2e8f0; border-radius: 12px; padding: 20px; margin-bottom: 16px; background: white; transition: all 0.3s ease; }
        .article-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.15); transform: translateY(-2px); }
        
        /* Graphiques */
        .chart-container { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        
        /* Modals */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
        .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 30px; border-radius: 12px; max-width: 600px; width: 90%; max-height: 90vh; overflow-y: auto; }
        .close { float: right; font-size: 28px; cursor: pointer; color: #64748b; }
        
        @media (max-width: 768px) {
            .tabs { flex-direction: column; }
            .tab { margin-bottom: 5px; }
            .control-buttons { flex-direction: column; }
            .btn { width: 100%; justify-content: center; margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- Header -->
        <header class="header">
            <h1>ğŸ“° AgrÃ©gateur RSS Intelligent (En dÃ©veloppement) </h1>
            <p>Analyse avancÃ©e des flux RSS avec IA et apprentissage automatique</p>
            <p>Olivier H. B. / Contact: ohenri.b@gmail.com</p>

            <!-- Panneau de contrÃ´le -->
            <div class="control-panel">
                <h3>ğŸ› ï¸ Centre de ContrÃ´le</h3>
                <div class="control-buttons" style="display: flex; gap: 12px; flex-wrap: wrap;">
                    <button class="btn btn-success" onclick="appCall('refreshArticles')">
                        ğŸ”„ Actualiser les donnÃ©es
                    </button>
                    <button class="btn btn-info" onclick="appCall('generateAIAnalysisReport')">
                        ğŸ§  GÃ©nÃ©rer rapport IA
                    </button>
                    <button class="btn btn-warning" onclick="appCall('exportArticlesToCSV')">
                        ğŸ“Š Exporter CSV
                    </button>
                    <button class="btn btn-secondary" onclick="appCall('exportToJSON')">
                        ğŸ’¾ Exporter JSON
                    </button>
                </div>
            </div>
        </header>

        <!-- Navigation par onglets -->
        <nav class="tabs">
            <button class="tab active" onclick="appCall('showTab', 'articles')">ğŸ“° Articles</button>
            <button class="tab" onclick="appCall('showTab', 'analysis')">ğŸ“ˆ Analyse</button>
            <button class="tab" onclick="appCall('showTab', 'themes')">ğŸ¨ ThÃ¨mes</button>
            <button class="tab" onclick="appCall('showTab', 'feeds')">ğŸ“¡ Flux RSS</button>
            <button class="tab" onclick="appCall('showTab', 'metrics')">ğŸ“Š MÃ©triques</button>
            <button class="tab" onclick="appCall('showTab', 'settings')">âš™ï¸ ParamÃ¨tres</button>
        </nav>

        <!-- Conteneur pour les messages -->
        <div id="messageContainer"></div>

        <!-- Onglet Articles -->
        <div id="articlesTab" class="tab-content active">
            <div class="card">
                <h2 style="margin-bottom: 20px; color: #1e40af;">ğŸ“° Articles RÃ©cents</h2>
                <div id="articlesList" class="loading">
                    Chargement des articles...
                </div>
            </div>
        </div>

        <!-- Onglet Analyse -->
        <div id="analysisTab" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 20px; color: #1e40af;">ğŸ“ˆ Analyse des DonnÃ©es</h2>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px;">
                    <div class="chart-container">
                        <h3>ğŸ“Š RÃ©partition par ThÃ¨me</h3>
                        <canvas id="themeChart" height="300"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸ˜Š Analyse des Sentiments</h3>
                        <canvas id="sentimentChart" height="300"></canvas>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                    <div class="chart-container">
                        <h3>ğŸ“ˆ Ã‰volution Temporelle</h3>
                        
                        <!-- ContrÃ´les de zoom (insÃ©rer avant <canvas id="timelineChart">) -->
                        <div style="display:flex; gap:8px; align-items:center; margin-bottom:8px;">
                            <button class="btn btn-secondary" onclick="zoomTimelineChart(1.5)" title="Zoom avant">ğŸ”+</button>
                            <button class="btn btn-secondary" onclick="zoomTimelineChart(0.66)" title="Zoom arriÃ¨re">ğŸ”âˆ’</button>
                            <button class="btn btn-secondary" onclick="resetTimelineZoom()" title="RÃ©initialiser zoom">â†º RÃ©init</button>
                                  <canvas id="timelineChart" height="300"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸš€ Ã‰volution des ThÃ¨mes</h3>
                        <canvas id="themeEvolutionChart" height="300"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3>ğŸ“… Ã‰volution du Sentiment</h3>
                        <canvas id="sentimentEvolutionChart" height="300"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglet ThÃ¨mes -->
        <div id="themesTab" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 20px; color: #1e40af;">ğŸ¨ Gestion des ThÃ¨mes</h2>
                <div id="themesManagerList" class="loading">
                    Chargement des thÃ¨mes...
                </div>
            </div>
        </div>

        <!-- Onglet Flux RSS -->
        <div id="feedsTab" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 20px; color: #1e40af;">ğŸ“¡ Gestion des Flux RSS</h2>
                <div id="feedsManagerList" class="loading">
                    Chargement des flux...
                </div>
            </div>
        </div>

        <!-- Onglet MÃ©triques -->
        <div id="metricsTab" class="tab-content">
            <div class="card">
                <h2 style="margin-bottom: 20px; color: #1e40af;">ğŸ“Š MÃ©triques Globales</h2>

                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                    <div class="metric-card" style="text-align: center; padding: 20px; background: #f0f9ff; border-radius: 12px;">
                        <h3>ğŸ“š Articles Totaux</h3>
                        <div style="font-size: 2.5rem; color: #3b82f6; font-weight: bold;" id="m_total">0</div>
                    </div>
                    <div class="metric-card" style="text-align: center; padding: 20px; background: #f0fdf4; border-radius: 12px;">
                        <h3>ğŸ¯ Confiance Moyenne</h3>
                        <div style="font-size: 2.5rem; color: #10b981; font-weight: bold;" id="m_confidence">0%</div>
                    </div>
                    <div class="metric-card" style="text-align: center; padding: 20px; background: #fef3c7; border-radius: 12px;">
                        <h3>ğŸ”¬ PostÃ©rieur Bayesien</h3>
                        <div style="font-size: 2.5rem; color: #f59e0b; font-weight: bold;" id="m_posterior">0%</div>
                    </div>
                    <div class="metric-card" style="text-align: center; padding: 20px; background: #fef2f2; border-radius: 12px;">
                        <h3>ğŸ”— Corroboration</h3>
                        <div style="font-size: 2.5rem; color: #ef4444; font-weight: bold;" id="m_corro">0%</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 15px;">ğŸ† ThÃ¨mes les Plus Populaires</h3>
                    <ul id="topThemes" style="list-style: none;">
                        <li class="loading">Chargement des thÃ¨mes...</li>
                    </ul>
                </div>
            </div>

            <!-- Statistiques de Sentiment -->
            <div id="sentimentOverview" class="card">
                <h3 style="margin-bottom: 20px;">ğŸ˜Š AperÃ§u des Sentiments</h3>
                <div class="loading">Chargement des statistiques de sentiment...</div>
            </div>

            <!-- Statistiques d'Apprentissage -->
            <div id="learningStats" class="card">
                <h3 style="margin-bottom: 20px;">ğŸ¤– Statistiques d'Apprentissage</h3>
                <div class="loading">Chargement des statistiques d'apprentissage...</div>
            </div>
        </div>

        <!-- Onglet ParamÃ¨tres -->
        <div id="settingsTab" class="tab-content">
            <div class="settings-container">
                <!-- Configuration IA -->
                <div class="card full-width" style="margin-bottom: 20px;">
                    <h3>ğŸ¤– Configuration de l'IA</h3>

                    <div style="margin: 20px 0; padding: 15px; background: #f8fafc; border-radius: 8px;">
                        <h4 style="margin-bottom: 15px;">ğŸŒ IA Distante (OpenAI)</h4>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ClÃ© API OpenAI:</label>
                            <input type="password" id="openaiKey" placeholder="sk-..." style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">ModÃ¨le:</label>
                            <select id="openaiModel" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                                <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                                <option value="gpt-4">GPT-4</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="appCall('saveAIConfig')">ğŸ’¾ Sauvegarder</button>
                        <button class="btn btn-secondary" onclick="appCall('testAIConnection')">ğŸ”Œ Tester</button>
                    </div>
                </div>

                <!-- Configuration Email -->
                <div class="card full-width" style="margin-bottom: 20px;">
                    <h3>âœ‰ï¸ Configuration Email</h3>

                    <div style="margin: 20px 0;">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Serveur SMTP:</label>
                            <input type="text" id="smtpHost" placeholder="smtp.gmail.com" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                        </div>
                        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Utilisateur:</label>
                                <input type="email" id="smtpUser" placeholder="votre-email@example.com" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; font-weight: 600;">Port:</label>
                                <input type="number" id="smtpPort" placeholder="587" value="587" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                            </div>
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Mot de passe:</label>
                            <input type="password" id="smtpPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                        </div>
                        <div style="margin-bottom: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px;">
                                <input type="checkbox" id="smtpSecure">
                                <span>Utiliser SSL/TLS</span>
                            </label>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="appCall('saveEmailConfig')">ğŸ’¾ Sauvegarder</button>
                        <button class="btn btn-secondary" onclick="appCall('testEmailConfig')">ğŸ“§ Tester</button>
                    </div>
                </div>

                <!-- Configuration Interface -->
                <div class="card full-width">
                    <h3>ğŸ¨ ParamÃ¨tres d'Interface</h3>

                    <div style="margin: 20px 0;">
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 10px; font-weight: 600;">ThÃ¨me visuel:</label>
                            <div style="display: flex; gap: 15px;">
                                <label style="padding: 15px; border: 2px solid #3b82f6; border-radius: 8px; cursor: pointer; flex: 1; text-align: center;">
                                    <input type="radio" name="theme" value="light" checked style="display: none;">
                                    <div style="font-size: 2rem;">â˜€ï¸</div>
                                    <div style="font-weight: 600; margin-top: 5px;">Clair</div>
                                </label>
                                <label style="padding: 15px; border: 2px solid #e2e8f0; border-radius: 8px; cursor: pointer; flex: 1; text-align: center;">
                                    <input type="radio" name="theme" value="dark" style="display: none;">
                                    <div style="font-size: 2rem;">ğŸŒ™</div>
                                    <div style="font-weight: 600; margin-top: 5px;">Sombre</div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="appCall('saveUIConfig')">ğŸ’¾ Sauvegarder</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal Ajout Flux RSS -->
        <div id="addFeedModal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="appCall('closeModal', 'addFeedModal')">&times;</span>
                <h2>â• Ajouter un Flux RSS</h2>
                <div style="margin: 20px 0;">
                    <input type="text" id="newFeedUrl" placeholder="https://example.com/rss" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;">
                </div>
                <div style="display: flex; gap: 10px;">
                    <button class="btn btn-success" onclick="appCall('showAddFeedModal')">âœ… Ajouter</button>
                    <button class="btn btn-secondary" onclick="appCall('closeModal', 'addFeedModal')">âŒ Annuler</button>
                </div>
            </div>
        </div>

        <!-- Modal Ajout ThÃ¨me â€” insÃ©rer avant le bouton flottant Rapport IA ou avant </div> de la "container" -->
        <div id="addThemeModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close" onclick="appCall('closeModal', 'addThemeModal')">&times;</span>
                <h2>â• Ajouter un ThÃ¨me</h2>

                <div style="margin: 12px 0; display: grid; gap:10px;">
                    <input type="text" id="newThemeName" placeholder="Nom du thÃ¨me" style="width: 100%; padding: 12px; border: 1px solid #e2e8f0; border-radius: 8px; font-size: 1rem;">

                    <textarea id="newThemeKeywords" placeholder="Mots-clÃ©s (un par ligne)" style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:8px; height:120px; font-family: monospace;"></textarea>

                    <div style="display:flex; gap:10px; align-items:center;">
                        <label style="display:flex; align-items:center; gap:8px;">
                            <span>Couleur:</span>
                            <input type="color" id="newThemeColor" value="#6366f1" style="height:36px; width:56px; border:none; background:transparent;">
                        </label>
                    </div>

                    <textarea id="newThemeDescription" placeholder="Description (optionnelle)" style="width:100%; padding:12px; border:1px solid #e2e8f0; border-radius:8px; height:80px;"></textarea>
                </div>

                <div style="display:flex; gap:10px; justify-content:flex-end; margin-top:10px;">
                    <button class="btn btn-success" onclick="appCall('createTheme')">âœ… Ajouter</button>
                    <button class="btn btn-secondary" onclick="appCall('closeModal', 'addThemeModal')">âŒ Annuler</button>
                </div>
            </div>
        </div>

        <!-- Bouton flottant Rapport IA -->
        <div style="position: fixed; bottom: 30px; right: 30px; z-index: 1000;">
            <button class="btn btn-info" onclick="appCall('generateAIAnalysisReport')" style="padding: 16px 20px; border-radius: 50px; box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4); font-size: 1.1rem;">
                ğŸ§  Rapport IA
            </button>
        </div>
    </div>

    <!-- CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Configuration -->
    <script>
        window.__API_BASE__ = 'http://localhost:3000';
        
        // Fonction sÃ©curisÃ©e pour appeler l'app
        function appCall(functionName, ...args) {
            if (window.app && window.app[functionName]) {
                return window.app[functionName](...args);
            } else {
                console.warn('App non disponible:', functionName);
                return false;
            }
        }
    </script>

    <!-- Application -->
    <script src="/app.js"></script>

    <!-- Initialisation -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ“„ DOM chargÃ©');
            
            const initApp = setInterval(() => {
                if (window.app && typeof window.app.init === 'function') {
                    clearInterval(initApp);
                    console.log('âœ… Initialisation de l app');
                    window.app.init();
                }
            }, 100);

            setTimeout(() => {
                clearInterval(initApp);
                if (!window.app) {
                    console.error('âŒ App non chargÃ©e aprÃ¨s 5s');
                }
            }, 5000);
        });
    </script>
</body>
</html>

