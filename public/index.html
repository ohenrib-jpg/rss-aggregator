<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agrégateur RSS Thématique</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <header>
        <h1>📊 Agrégateur RSS Thématique</h1>
        <p>Analysez vos flux RSS par thèmes personnalisés - Détection avancée des tendances et analyse de sentiment</p>
    </header>

    <div id="messageContainer"></div>

    <div class="status-bar">
        <div class="last-update" id="lastUpdate">Chargement...</div>
        <div class="refresh-controls">
            <div class="auto-refresh-indicator"><span class="blink">🔄</span> Auto-actualisation</div>
            <button class="refresh" onclick="app.manualRefresh()" id="refreshBtn">🔄 Générer</button>
        </div>
    </div>

    <div class="export-bar">
        <div class="export-controls">
            <button class="export-btn json" onclick="app.exportData('json')">📥 Export JSON</button>
            <button class="export-btn csv" onclick="app.exportData('csv')">📥 Export CSV</button>
            <button class="export-btn stats" onclick="app.showLearningStats()">📊 Stats Apprentissage</button>
        </div>
    </div>

    <div class="stats-grid" id="statsGrid">
        <div class="loading">Chargement des données...</div>
    </div>

    <div class="tab-container">
        <div class="tabs">
            <div class="tab active" onclick="showTab('analysis', event)">📈 Analyse</div>
            <div class="tab" onclick="showTab('trends', event)">📊 Tendances</div>
            <div class="tab" onclick="showTab('metrics', event)">🎯 Métriques</div>
            <div class="tab" onclick="showTab('sentiment', event)">😊 Sentiment</div>
            <div class="tab" onclick="showTab('learning', event)">🧠 Apprentissage</div>
            <div class="tab" onclick="showTab('feeds', event)">📰 Flux RSS</div>
            <div class="tab" onclick="showTab('themes', event)">🎨 Thèmes</div>
            <div class="tab" onclick="showTab('articles', event)">📄 Articles</div>
        </div>

        <!-- Onglet Analyse -->
        <div id="analysisTab" class="tab-content active">
            <div class="dashboard">
                <div class="card">
                    <h3>Répartition par Thème</h3>
                    <canvas id="themeChart" height="250"></canvas>
                </div>
                <div class="card">
                    <h3>Évolution Temporelle</h3>
                    <canvas id="timelineChart" height="250"></canvas>
                </div>
            </div>
        </div>

        <!-- Onglet Tendances -->
        <div id="trendsTab" class="tab-content">
            <div class="dashboard">
                <div class="card full-width">
                    <h3>📈 Évolution des Thèmes</h3>
                    <div id="trendsTable" class="trends-table">
                        <div class="loading">Calcul des tendances...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ✅ Onglet Métriques Amélioré -->
        <div id="metricsTab" class="tab-content">
            <div class="dashboard">
                <div class="card full-width">
                    <h3>🎯 Statistiques Globales</h3>
                    <div class="metrics-cards" style="display:flex;gap:15px;flex-wrap:wrap;">
                        <div class="metric-card">
                            <strong>Total Articles :</strong> <span id="m_total">—</span>
                        </div>
                        <div class="metric-card">
                            <strong>Confiance Moyenne :</strong> <span id="m_confidence">—</span>
                        </div>
                        <div class="metric-card">
                            <strong>Fiabilité Bayésienne :</strong> <span id="m_posterior">—</span>
                        </div>
                        <div class="metric-card">
                            <strong>Corroboration Moyenne :</strong> <span id="m_corro">—</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard">
                <div class="card full-width">
                    <h3>📈 Évolution du Sentiment (30 derniers jours)</h3>
                    <canvas id="sentimentChart" height="280"></canvas>
                </div>
            </div>

            <div class="dashboard">
                <div class="card full-width">
                    <h3>🏆 Thèmes Principaux</h3>
                    <ul id="topThemes" class="top-themes" style="list-style:none;padding:0;"></ul>
                </div>
            </div>
        </div>

        <!-- Onglet Sentiment -->
        <div id="sentimentTab" class="tab-content">
            <div class="dashboard">
                <div class="card full-width">
                    <h3>📊 Aperçu du Sentiment Global</h3>
                    <div id="sentimentOverview"><div class="loading">Analyse de sentiment...</div></div>
                </div>
            </div>
        </div>

        <!-- Onglet Apprentissage -->
        <div id="learningTab" class="tab-content">
            <div class="dashboard">
                <div class="card full-width">
                    <h3>🧠 Apprentissage</h3>
                    <div id="learningStats"><div class="loading">Chargement...</div></div>
                </div>
            </div>
        </div>

        <!-- Onglet Flux -->
        <div id="feedsTab" class="tab-content">
            <div class="card">
                <h3>📋 Flux RSS</h3>
                <div id="feedsList"><div class="loading">Chargement des flux...</div></div>
            </div>
        </div>

        <!-- Onglet Thèmes -->
        <div id="themesTab" class="tab-content">
            <div class="card">
                <h3>🎨 Mes Thèmes</h3>
                <div id="themesList"><div class="loading">Chargement des thèmes...</div></div>
            </div>
        </div>

        <!-- Onglet Articles -->
        <div id="articlesTab" class="tab-content">
            <div class="card">
                <h3>📄 Derniers Articles</h3>
                <div id="articlesList"><div class="loading">Chargement des articles...</div></div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Apprentissage -->
<div id="learningStatsModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3>📊 Statistiques d'Apprentissage</h3>
        <div id="modalLearningStats"><div class="loading">Chargement...</div></div>
    </div>
</div>

<script src="app.js"></script>
</body>
</html>
