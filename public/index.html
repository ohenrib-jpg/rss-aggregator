<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgrÃ©gateur RSS + IA v2.3</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
<div class="container">
    <!-- En-tÃªte -->
    <header>
        <div class="header-main">
            <h1>ğŸ“Š AgrÃ©gateur RSS ThÃ©matique + IA</h1>
            <div style="display: flex; gap: 15px; margin-top: 10px; flex-wrap: wrap;">
                <span style="background: rgba(255,255,255,0.2); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem;">Olivier Henri B.</span>
                <span style="background: rgba(255,255,255,0.15); padding: 5px 10px; border-radius: 6px; font-family: monospace; font-size: 0.85rem;">V.2.3</span>
                <span id="aiStatus" style="background: rgba(255,255,255,0.15); padding: 5px 10px; border-radius: 6px; font-size: 0.85rem;">ğŸ¤– IA: VÃ©rification...</span>
            </div>
        </div>
    </header>

    <!-- Messages -->
    <div id="messageContainer"></div>

    <!-- Barre de statut -->
    <div class="status-bar">
        <div class="last-update" id="lastUpdate">Chargement...</div>
        <div class="refresh-controls">
            <div class="auto-refresh-indicator"><span class="blink">ğŸ”„</span> Auto-actualisation</div>
            <button id="refreshBtn">ğŸ”„ Actualiser</button>
        </div>
    </div>

    <!-- Barre d'actions -->
    <div class="export-bar">
        <div class="export-controls">
            <button class="btn btn-success export-btn json">ğŸ“¥ JSON</button>
            <button class="btn btn-success export-btn csv">ğŸ“¥ CSV</button>
            <button class="btn btn-secondary export-btn stats">ğŸ“Š Stats IA</button>
            <button class="btn btn-secondary" onclick="showAIConfig()">âš™ï¸ Config IA</button>
        </div>
    </div>

    <!-- Onglets -->
    <div class="tab-container">
        <div class="tabs">
            <div class="tab active" onclick="showTab('analysis')">ğŸ“ˆ Analyse</div>
            <div class="tab" onclick="showTab('metrics')">ğŸ¯ MÃ©triques</div>
            <div class="tab" onclick="showTab('sentiment')">ğŸ˜Š Sentiment</div>
            <div class="tab" onclick="showTab('learning')">ğŸ§  Apprentissage</div>
            <div class="tab" onclick="showTab('feeds')">ğŸ“° Flux RSS</div>
            <div class="tab" onclick="showTab('themes')">ğŸ¨ ThÃ¨mes</div>
            <div class="tab" onclick="showTab('articles')">ğŸ“„ Articles</div>
        </div>

        <!-- Analyse -->
        <div id="analysisTab" class="tab-content active">
            <div class="dashboard">
                <div class="card">
                    <h3>ğŸ“Š RÃ©partition par ThÃ¨me</h3>
                    <canvas id="themeChart"></canvas>
                </div>
                <div class="card">
                    <h3>ğŸ“ˆ Ã‰volution Temporelle</h3>
                    <canvas id="timelineChart"></canvas>
                </div>
            </div>
        </div>

        <!-- MÃ©triques -->
        <div id="metricsTab" class="tab-content">
            <div class="stats-grid">
                <div class="metric-card"><strong>Total Articles :</strong> <span id="m_total">â€”</span></div>
                <div class="metric-card"><strong>Confiance :</strong> <span id="m_confidence">â€”</span></div>
                <div class="metric-card"><strong>BayÃ©sien :</strong> <span id="m_posterior">â€”</span></div>
                <div class="metric-card"><strong>Corroboration :</strong> <span id="m_corro">â€”</span></div>
            </div>
            <div class="dashboard">
                <div class="card full-width">
                    <h3>ğŸ“ˆ Ã‰volution du Sentiment</h3>
                    <canvas id="sentimentChart"></canvas>
                </div>
            </div>
            <div class="dashboard">
                <div class="card full-width">
                    <h3>ğŸ† ThÃ¨mes Principaux</h3>
                    <ul id="topThemes" class="top-themes"></ul>
                </div>
            </div>
        </div>

        <!-- Sentiment -->
        <div id="sentimentTab" class="tab-content">
            <div id="sentimentOverview" class="loading">Analyse de sentiment...</div>
        </div>

        <!-- Apprentissage -->
        <div id="learningTab" class="tab-content">
            <div id="learningStats" class="loading">Chargement...</div>
        </div>

        <!-- Flux RSS -->
        <div id="feedsTab" class="tab-content">
            <div class="card">
                <h3>ğŸ“‹ Mes Flux RSS</h3>
                <div id="feedsList" class="loading">Chargement...</div>
            </div>
        </div>

        <!-- ThÃ¨mes -->
        <div id="themesTab" class="tab-content">
            <div class="card">
                <h3>ğŸ¨ Mes ThÃ¨mes</h3>
                <div id="themesList" class="loading">Chargement...</div>
            </div>
        </div>

        <!-- Articles -->
        <div id="articlesTab" class="tab-content">
            <div class="card full-width">
                <h3>ğŸ“„ Derniers Articles</h3>
                <div id="articlesList" class="loading">Chargement...</div>
            </div>
        </div>
    </div>
</div>

<!-- Modal Stats IA -->
<div id="learningStatsModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('learningStatsModal')">&times;</span>
        <h2>ğŸ“Š Statistiques d'Apprentissage IA</h2>
        <div id="modalLearningStats" class="loading">Chargement...</div>
    </div>
</div>

<!-- Modal Configuration IA -->
<div id="aiConfigModal" class="modal">
    <div class="modal-content">
        <span class="close" onclick="closeModal('aiConfigModal')">&times;</span>
        <h2>âš™ï¸ Configuration de l'IA</h2>
        
        <div style="margin: 25px 0;">
            <h3 style="margin-bottom: 15px;">ğŸŒ IA Distante (OpenAI)</h3>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">ClÃ© API OpenAI :</label>
                <input type="password" id="openaiKey" placeholder="sk-..." style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                <small style="color: #64748b;">Obtenez une clÃ© gratuite sur <a href="https://platform.openai.com/api-keys" target="_blank">OpenAI</a></small>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">ModÃ¨le :</label>
                <select id="openaiModel" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo (rapide)</option>
                    <option value="gpt-4">GPT-4 (prÃ©cis)</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                </select>
            </div>
        </div>

        <div style="margin: 25px 0; padding-top: 20px; border-top: 1px solid #e2e8f0;">
            <h3 style="margin-bottom: 15px;">ğŸ’» IA Locale (Llama.cpp)</h3>
            <div style="margin-bottom: 15px;">
                <label style="display: flex; align-items: center; gap: 10px;">
                    <input type="checkbox" id="enableLocal">
                    <span>Utiliser l'IA locale (fallback)</span>
                </label>
                <small style="color: #64748b; display: block; margin-top: 5px;">NÃ©cessite Llama.cpp installÃ© localement</small>
            </div>
            <div style="margin-bottom: 15px;">
                <label style="display: block; margin-bottom: 5px; font-weight: 600;">URL Llama.cpp :</label>
                <input type="text" id="llamaUrl" placeholder="http://localhost:8080" value="http://localhost:8080" style="width: 100%; padding: 10px; border: 1px solid #e2e8f0; border-radius: 8px;">
            </div>
        </div>

        <div style="display: flex; gap: 10px; margin-top: 25px;">
            <button class="btn btn-success" onclick="saveAIConfig()">ğŸ’¾ Sauvegarder</button>
            <button class="btn btn-secondary" onclick="testAIConnection()">ğŸ” Tester la connexion</button>
            <button class="btn btn-secondary" onclick="closeModal('aiConfigModal')">âŒ Annuler</button>
        </div>
    </div>
</div>

<script src="app.js"></script>
<script src="chart-manager.js"></script>
</body>
</html>
