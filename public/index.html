<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agr√©gateur RSS Th√©matique + IA V.1.2</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <!-- Nouveau bandeau sup√©rieur am√©lior√© -->
            <div class="header-main">
                <div class="header-title">
                    <h1>üìä Agr√©gateur RSS Th√©matique</h1>
                    <div class="header-subtitle">
                        <span class="author">Olivier Henri B.</span>
                        <span class="version">V.2.3</span>
                    </div>
                </div>
                <div class="header-tagline">
                    Analyse de flux RSS par th√®mes personnalis√©s - D√©tection avanc√©e des tendances-DeepLearning (V.2) + IA
                </div>
            </div>

            <!-- Bandeau de d√©monstration am√©lior√© -->
            <div class="demo-banner" role="note" aria-live="polite">
                <div class="demo-icon">üöÄ</div>
                <div class="demo-content">
                    <div class="demo-title">Application de d√©monstration</div>
                    <div class="demo-text">
                        Avec √† pr√©sent la possibilit√© de stocker jusqu‚Äô√† 1Go de donn√©es (Merci √† Render!). Attention¬†: cela reste un serveur de test et de pr√©sentation, il se r√©initialise automatiquement lorsque les quotas allou√©s sont atteints 
                    </div>
                    <div class="demo-api-info">
                        Testez la fonction IA avec une cl√© API gratuite sur 
                        <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer">OpenAI</a>
                    </div>
                </div>
            </div>
        </header>

        <div id="messageContainer"></div>

        <div class="status-bar">
            <div class="last-update" id="lastUpdate">
                Chargement...
            </div>
            <div class="refresh-controls">
                <div class="auto-refresh-indicator">
                    <span class="blink">üîÑ</span> Auto-actualisation
                </div>
                <button class="refresh" onclick="app.manualRefresh()" id="refreshBtn">
                    üîÑ G√©n√©rer
                </button>
            </div>
        </div>

        <!-- Barre d'export r√©organis√©e sur 2 lignes -->
        <div class="export-bar">
            <!-- Premi√®re ligne de boutons -->
            <div class="export-row">
                <button class="export-btn json" onclick="app.exportData('json')">
                    üì• Export JSON
                </button>
                <button class="export-btn csv" onclick="app.exportData('csv')">
                    üì• Export CSV
                </button>
                <button class="export-btn stats" onclick="app.showLearningStats()">
                    üìä Stats Apprentissage
                </button>
            </div>
            
            <!-- Deuxi√®me ligne de boutons -->
            <div class="export-row">
                <button class="export-btn ia" onclick="app.runAIAnalysis()" id="iaAnalyzeBtn">
                    üß† Analyse IA
                </button>
                <button class="export-btn ia-config" onclick="app.showIAApiKeyModal()" id="iaConfigBtn">
                    ‚öôÔ∏è Config IA
                </button>
            </div>
        </div>

        <!-- Indicateur Corrections IA -->
        <div id="iaStatusBar" class="status-bar" style="display: none; border-left-color: #8b5cf6;">
            <div class="auto-refresh-indicator">
                <span class="blink">ü§ñ</span> 
                <span id="iaStatusText">Corrections IA actives</span>
            </div>
            <div class="refresh-controls">
                <span id="iaLastCorrection">Derni√®re correction: --</span>
                <button class="refresh" onclick="app.manualIACorrection()" id="iaCorrectBtn">
                    üîß Corriger maintenant
                </button>
            </div>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="loading">Chargement des donn√©es...</div>
        </div>

        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" onclick="showTab('analysis', event)">üìà Analyse</div>
                <div class="tab" onclick="showTab('trends', event)">üìä Tendances</div>
                <div class="tab" onclick="showTab('metrics', event)">üéØ M√©triques</div>
                <div class="tab" onclick="showTab('sentiment', event)">üòä Sentiment</div>
                <div class="tab" onclick="showTab('learning', event)">üß† Apprentissage</div>
                <div class="tab" onclick="showTab('ia-corrections', event)">ü§ñ Corrections IA</div>
                <div class="tab" onclick="showTab('feeds', event)">üì∞ Flux RSS</div>
                <div class="tab" onclick="showTab('themes', event)">üé® Th√®mes</div>
                <div class="tab" onclick="showTab('articles', event)">üìÑ Articles</div>
            </div>

            <!-- Onglet Analyse Principale -->
            <div id="analysisTab" class="tab-content active">
                <div class="dashboard">
                    <div class="card">
                        <h3>
                            R√©partition par Th√®me 
                            <span class="info-icon" title="Seuls les th√®mes ayant au moins une correspondance sont affich√©s">‚ÑπÔ∏è</span>
                        </h3>
                        <canvas id="themeChart" height="250"></canvas>
                    </div>
                    <div class="card">
    <h3>√âvolution Temporelle</h3>
    
     <!-- Contr√¥les avanc√©s du graphique -->
        <div class="chart-controls-bar">
            <div class="control-group">
                <label>√âchelle temporelle :</label>
                    <select id="timeScale" onchange="chartManager.changeTimeScale(this.value)">
                    <option value="day">Par jour</option>
                    <option value="week" selected>Par semaine</option>
                    <option value="month">Par mois</option>
                    <option value="quarter">Par trimestre</option>
                </select>
            </div>
        
                   <div class="control-group">
                   <label>Agr√©gation :</label>
                   <select id="aggregationType" onchange="chartManager.changeAggregation(this.value)">
                    <option value="count">Nombre d'articles</option>
                    <option value="percentage">Pourcentage</option>
                    <option value="movingAverage">Moyenne mobile (7j)</option>
                  </select>
                </div>
        
                 <div class="control-group">
                 <button onclick="chartManager.toggleMinorThemes()" class="toggle-minor-btn">
                  üëÅÔ∏è Masquer th√®mes mineurs
                 </button>
                 <button onclick="chartManager.exportChartData()" class="export-data-btn">
                  üì• Exporter donn√©es
                </button>
              </div>
          </div>
    
                    <!-- Le s√©lecteur de th√®mes sera inject√© ici automatiquement -->
    
                    <div class="chart-container">
                    <canvas id="timelineChart" height="400"></canvas>
                  </div>
    
                  <!-- L√©gende interactive -->
                  <div class="chart-legend" id="timelineLegend"></div>
                   </div>
                </div>
            </div>

            <!-- Onglet Tendances -->
            <div id="trendsTab" class="tab-content">
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>üìà √âvolution des Th√®mes</h3>
                        <div id="trendsTable" class="trends-table">
                            <div class="loading">Calcul des tendances...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card">
                        <h3>üîº Th√®mes en Croissance</h3>
                        <div id="growthThemes" class="trends-list">
                            <div class="loading">Analyse en cours...</div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üîΩ Th√®mes en Baisse</h3>
                        <div id="declineThemes" class="trends-list">
                            <div class="loading">Analyse en cours...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet M√©triques Avanc√©es -->
            <div id="metricsTab" class="tab-content">
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>üéØ Efficacit√© des Mots-Cl√©s</h3>
                        <div id="keywordMetrics" class="metrics-table">
                            <div class="loading">Analyse des mots-cl√©s...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card">
                        <h3>üîÑ Corr√©lations entre Th√®mes</h3>
                        <div id="correlationsMatrix" class="correlations-matrix">
                            <div class="loading">Calcul des corr√©lations...</div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üìÖ Analyse Saisonni√®re</h3>
                        <div id="seasonalityAnalysis" class="seasonality-chart">
                            <div class="loading">Analyse saisonni√®re...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Analyse de Sentiment -->
            <div id="sentimentTab" class="tab-content">
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>üìä Aper√ßu du Sentiment Global</h3>
                        <div id="sentimentOverview">
                            <div class="loading">Analyse de sentiment en cours...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>üé® √âvolution des Sentiments par Th√®mes</h3>
                        <div id="sentimentByTheme">
                            <div class="loading">Calcul des sentiments par th√®me...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card">
                        <h3>üòä Articles Positifs</h3>
                        <div id="positiveArticles" class="articles-list">
                            <div class="loading">Chargement des articles positifs...</div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üòû Articles N√©gatifs</h3>
                        <div id="negativeArticles" class="articles-list">
                            <div class="loading">Chargement des articles n√©gatifs...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ONGLET : Apprentissage -->
            <div id="learningTab" class="tab-content">
                <div class="dashboard">
                    <div class="card">
                        <h3>üß† Statistiques d'Apprentissage</h3>
                        <div id="learningStats">
                            <div class="loading">Chargement des statistiques...</div>
                        </div>
                        <div class="learning-actions">
                            <button onclick="app.refreshLearningStats()" class="refresh">üîÑ Actualiser</button>
                            <button onclick="app.resetLearning()" class="delete">üóëÔ∏è R√©initialiser</button>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üéì Apprentissage Manuel</h3>
                        <div class="learning-form">
                            <textarea id="learningText" placeholder="Entrez le texte √† analyser..." rows="4"></textarea>
                            <div class="score-slider">
                                <label>Score attendu: <span id="scoreValue">0.00</span></label>
                                <input type="range" id="expectedScore" min="-1" max="1" step="0.1" value="0">
                                <div class="score-labels">
                                    <span>N√©gatif (-1)</span>
                                    <span>Neutre (0)</span>
                                    <span>Positif (+1)</span>
                                </div>
                            </div>
                            <button onclick="app.learnFromCorrection()" class="learn-btn">üéì Apprendre</button>
                            <div id="learningResult" class="learning-result"></div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>üìà Mots Appris R√©cemment</h3>
                        <div id="learnedWords" class="learned-words">
                            <div class="loading">Chargement des mots appris...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- NOUVEL ONGLET : Corrections IA -->
            <div id="ia-correctionsTab" class="tab-content">
                <div class="dashboard">
                    <div class="card">
                        <h3>ü§ñ √âtat des Corrections IA</h3>
                        <div id="iaStatusOverview">
                            <div class="loading">Chargement des corrections IA...</div>
                        </div>
                        <div class="learning-actions">
                            <button onclick="app.manualIACorrection()" class="refresh">üîß Correction Manuelle</button>
                            <button onclick="app.configureIA()" class="learn-btn">‚öôÔ∏è Configuration IA</button>
                        </div>
                    </div>
                    <div class="card">
                        <h3>üìà Statistiques des Corrections</h3>
                        <div id="iaCorrectionsStats">
                            <div class="loading">Calcul des statistiques...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>üìã Historique des Corrections</h3>
                        <div id="iaCorrectionsHistory" class="articles-list">
                            <div class="loading">Chargement de l'historique...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Flux RSS -->
            <div id="feedsTab" class="tab-content">
                <div class="card">
                    <h3>‚ûï Ajouter un Flux RSS</h3>
                    <div class="form-group">
                        <input type="url" id="feedUrl" placeholder="https://exemple.com/flux.rss" required>
                        <button onclick="addFeed()">Ajouter le flux</button>
                    </div>
                    <small>Exemples: https://www.lemonde.fr/rss/une.xml, https://www.liberation.fr/arc/outboundfeeds/rss-all/collection/accueil-une/</small>
                </div>
                <div class="card">
                    <h3>üìã Mes Flux RSS</h3>
                    <div id="feedsList">
                        <div class="loading">Chargement des flux...</div>
                    </div>
                </div>
            </div>

            <!-- Onglet Th√®mes -->
            <div id="themesTab" class="tab-content">
                <div class="card">
                    <h3>üé® Cr√©er un Th√®me</h3>
                    <div class="form-group">
                        <input type="text" id="themeName" placeholder="Nom du th√®me (ex: Joie)" required>
                        <textarea id="themeKeywords" placeholder="Mots-cl√©s (s√©par√©s par des virgules): joie, bonheur, succ√®s, r√©ussite" rows="3" required></textarea>
                        
                        <div class="color-picker-section">
                            <label for="themeColor">Couleur du th√®me :</label>
                            <div class="color-picker-container">
                                <input type="color" id="themeColor" value="#6366f1" class="color-input">
                                <div class="color-presets">
                                    <div class="color-preset" style="background-color: #6366f1;" data-color="#6366f1"></div>
                                    <div class="color-preset" style="background-color: #10b981;" data-color="#10b981"></div>
                                    <div class="color-preset" style="background-color: #f59e0b;" data-color="#f59e0b"></div>
                                    <div class="color-preset" style="background-color: #ef4444;" data-color="#ef4444"></div>
                                    <div class="color-preset" style="background-color: #8b5cf6;" data-color="#8b5cf6"></div>
                                    <div class="color-preset" style="background-color: #06b6d4;" data-color="#06b6d4"></div>
                                    <div class="color-preset" style="background-color: #84cc16;" data-color="#84cc16"></div>
                                    <div class="color-preset" style="background-color: #f97316;" data-color="#f97316"></div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="addTheme()">Cr√©er le th√®me</button>
                    </div>
                </div>
                <div class="card">
                    <h3>üé® Mes Th√®mes</h3>
                    <div id="themesList">
                        <div class="loading">Chargement des th√®mes...</div>
                    </div>
                </div>
            </div>

            <!-- Onglet Articles -->
            <div id="articlesTab" class="tab-content">
                <div class="card">
                    <h3>üìÑ Derniers Articles</h3>
                    <div class="articles-list" id="articlesList">
                        <div class="loading">Chargement des articles...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour les statistiques d'apprentissage -->
    <div id="learningStatsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>üìä Statistiques d'Apprentissage</h3>
            <div id="modalLearningStats">
                <div class="loading">Chargement...</div>
            </div>
        </div>
    </div>

    <!-- NOUVEAU : Modal pour la configuration IA -->
    <div id="iaApiKeyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="app.closeIAApiKeyModal()">&times;</span>
            <h3>üîë Configuration de l'IA</h3>
            <div class="api-key-form">
                <div class="form-group">
                    <label for="iaApiKey">Cl√© API IA :</label>
                    <input type="password" id="iaApiKey" placeholder="sk-..." class="api-key-input">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="iaAutoCorrection" checked>
                        Corrections automatiques toutes les heures
                    </label>
                </div>
                
                <div class="api-key-info">
                    <p><strong>Fonctionnalit√©s activ√©es :</strong></p>
                    <ul>
                        <li>‚úÖ Correction des scores de sentiment</li>
                        <li>‚úÖ D√©tection des faux positifs/n√©gatifs</li>
                        <li>‚úÖ Analyse contextuelle avanc√©e</li>
                        <li>‚úÖ V√©rification externe par scraping</li>
                        <li>‚úÖ G√©n√©ration de rapports PDF</li>
                    </ul>
                </div>
                
                <div class="api-key-actions">
                    <button onclick="app.saveIAApiKey()" class="save-btn">üíæ Enregistrer</button>
                    <button onclick="app.disableIA()" class="delete">üóëÔ∏è D√©sactiver IA</button>
                    <button onclick="app.closeIAApiKeyModal()" class="cancel-btn">Annuler</button>
                </div>
                
                <small class="api-key-note">
                    La cl√© API est stock√©e localement dans votre navigateur et utilis√©e uniquement pour les corrections IA.
                </small>
            </div>
        </div>
    </div>

    <script src="app.js"></script>

    <style>
        /* Styles pour le nouveau header */
        .header-main {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .header-title h1 {
            margin: 0 0 8px 0;
            font-size: 2rem;
            font-weight: 700;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-subtitle {
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .header-subtitle .author {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 600;
        }

        .header-subtitle .version {
            background: rgba(255,255,255,0.15);
            padding: 4px 8px;
            border-radius: 6px;
            font-family: monospace;
        }

        .header-tagline {
            font-size: 1rem;
            opacity: 0.9;
            margin-top: 8px;
            line-height: 1.4;
        }

        /* Styles pour le bandeau de d√©monstration am√©lior√© */
        .demo-banner {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            background: linear-gradient(135deg, #fff3cd 0%, #ffeaa7 100%);
            border: 1px solid #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .demo-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .demo-content {
            flex: 1;
        }

        .demo-title {
            font-weight: 700;
            font-size: 1rem;
            color: #2d3436;
            margin-bottom: 6px;
        }

        .demo-text {
            font-size: 0.9rem;
            color: #636e72;
            line-height: 1.4;
            margin-bottom: 8px;
        }

        .demo-api-info {
            font-size: 0.85rem;
            color: #0984e3;
        }

        .demo-api-info a {
            color: #0984e3;
            text-decoration: none;
            font-weight: 600;
        }

        .demo-api-info a:hover {
            text-decoration: underline;
        }

        /* Styles pour la barre d'export r√©organis√©e */
        .export-bar {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
        }

        .export-row {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .export-row:first-child {
            margin-bottom: 10px;
        }

        .export-btn {
            flex: 1;
            min-width: 140px;
            max-width: 200px;
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .export-btn.json {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
        }

        .export-btn.csv {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }

        .export-btn.ia {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
        }

        .export-btn.ia-config {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
        }

        .export-btn.stats {
            background: linear-gradient(135deg, #06b6d4, #0891b2);
            color: white;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .export-row {
                flex-direction: column;
                align-items: center;
            }
            
            .export-btn {
                min-width: 100%;
                max-width: 100%;
            }
            
            .header-title h1 {
                font-size: 1.6rem;
            }
            
            .header-subtitle {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .demo-banner {
                flex-direction: column;
                text-align: center;
            }
            
            .demo-icon {
                align-self: center;
            }
        }
    </style>
</body>
</html>