<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Analyseur d'Actualités IA</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <h1>📰 Analyseur d'Actualités IA</h1>
      <p>Analyse en temps réel des flux RSS avec intelligence artificielle</p>
    </header>

    <div id="messageContainer"></div>

    <nav class="tabs">
      <button class="tab active" onclick="showTab('articles')">📋 Articles</button>
      <button class="tab" onclick="showTab('analysis')">📊 Analyse</button>
      <button class="tab" onclick="showTab('metrics')">📈 Métriques</button>
      <button class="tab" onclick="showTab('sentiment')">😊 Sentiment</button>
      <button class="tab" onclick="showTab('learning')">🧠 Apprentissage</button>
      <button class="tab" onclick="showTab('feeds')">📡 Flux RSS</button>
      <button class="tab" onclick="showTab('themes')">🏷️ Thèmes</button>
      <button class="tab" onclick="showAIConfig()">⚙️ Configuration IA</button>
    </nav>

    <!-- Onglet Articles -->
    <div id="articlesTab" class="tab-content active">
      <h2>📋 Articles Récents</h2>
      <div class="controls">
        <button class="btn btn-primary" onclick="window.app.loadArticles()">🔄 Actualiser</button>
        <button class="btn btn-secondary" onclick="window.app.loadThemesFromFile()">📁 Charger thèmes fichier</button>
      </div>
      <div id="articlesList" class="articles-grid">
        <div class="loading">Chargement des articles...</div>
      </div>
    </div>

    <!-- Onglet Analyse -->
    <div id="analysisTab" class="tab-content">
      <h2>📊 Analyse des Données</h2>
      <div class="charts-grid">
        <div class="chart-container">
          <canvas id="themeChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="timelineChart"></canvas>
        </div>
        <div class="chart-container">
          <canvas id="sentimentChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Onglet Métriques -->
    <div id="metricsTab" class="tab-content">
      <h2>📈 Métriques de Performance</h2>
      <div class="metrics-grid">
        <div class="metric-card">
          <h3>📊 Total Articles</h3>
          <div id="m_total" class="metric-value">0</div>
        </div>
        <div class="metric-card">
          <h3>🎯 Confiance Moyenne</h3>
          <div id="m_confidence" class="metric-value">0.00</div>
        </div>
        <div class="metric-card">
          <h3>📈 Postérieur Bayesien</h3>
          <div id="m_posterior" class="metric-value">0.00</div>
        </div>
        <div class="metric-card">
          <h3>🔗 Force de Corroboration</h3>
          <div id="m_corro" class="metric-value">0.00</div>
        </div>
      </div>
      
      <div class="section">
        <h3>🏆 Thèmes Principaux</h3>
        <ul id="topThemes" class="themes-list">
          <li>Chargement...</li>
        </ul>
      </div>
    </div>

    <!-- Onglet Sentiment -->
    <div id="sentimentTab" class="tab-content">
      <h2>😊 Analyse de Sentiment</h2>
      <div id="sentimentOverview">
        <div class="loading">Chargement des données de sentiment...</div>
      </div>
      <div class="chart-container">
        <canvas id="sentimentEvolutionChart"></canvas>
      </div>
    </div>

    <!-- Onglet Apprentissage -->
    <div id="learningTab" class="tab-content">
      <h2>🧠 Apprentissage Automatique</h2>
      <div id="learningStats">
        <div class="loading">Chargement des statistiques d'apprentissage...</div>
      </div>
    </div>

    <!-- Onglet Flux RSS -->
    <div id="feedsTab" class="tab-content">
      <h2>📡 Gestion des Flux RSS</h2>
      <div class="controls">
        <button class="btn btn-primary" onclick="showAddFeedModal()">➕ Ajouter un flux</button>
        <button class="btn btn-secondary" onclick="window.app.loadFeedsManager()">🔄 Actualiser</button>
      </div>
      <div id="feedsManagerList">
        <div class="loading">Chargement des flux...</div>
      </div>
    </div>

    <!-- Onglet Thèmes -->
    <div id="themesTab" class="tab-content">
      <h2>🏷️ Gestion des Thèmes</h2>
      <div class="controls">
        <button class="btn btn-primary" onclick="showAddThemeModal()">➕ Ajouter un thème</button>
        <button class="btn btn-secondary" onclick="window.app.loadThemesManager()">🔄 Actualiser</button>
        <button class="btn btn-secondary" onclick="window.app.loadThemesFromFile()">📁 Charger depuis fichier</button>
      </div>
      <div id="themesManagerList">
        <div class="loading">Chargement des thèmes...</div>
      </div>
    </div>
  </div>

  <!-- Modal Configuration IA -->
  <div id="aiConfigModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('aiConfigModal')">&times;</span>
      <h2>⚙️ Configuration IA</h2>
      
      <div class="form-group">
        <label for="openaiKey">Clé API OpenAI:</label>
        <input type="password" id="openaiKey" placeholder="sk-...">
      </div>
      
      <div class="form-group">
        <label for="openaiModel">Modèle OpenAI:</label>
        <select id="openaiModel">
          <option value="gpt-3.5-turbo">gpt-3.5-turbo</option>
          <option value="gpt-4">gpt-4</option>
          <option value="gpt-4-turbo">gpt-4-turbo</option>
        </select>
      </div>
      
      <div class="form-group">
        <label>
          <input type="checkbox" id="enableLocal"> Activer le modèle local (Llama)
        </label>
      </div>
      
      <div class="form-group">
        <label for="llamaUrl">URL API Llama locale:</label>
        <input type="text" id="llamaUrl" placeholder="http://localhost:8080">
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="saveAIConfig()">💾 Sauvegarder</button>
        <button class="btn btn-secondary" onclick="testAIConnection()">🔗 Tester la connexion</button>
        <button class="btn" onclick="closeModal('aiConfigModal')">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Modal Ajouter Flux -->
  <div id="addFeedModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addFeedModal')">&times;</span>
      <h2>➕ Ajouter un Flux RSS</h2>
      
      <div class="form-group">
        <label for="newFeedUrl">URL du flux RSS:</label>
        <input type="url" id="newFeedUrl" placeholder="https://example.com/feed.xml" required>
      </div>
      
      <div class="form-group">
        <label for="newFeedTitle">Titre (optionnel):</label>
        <input type="text" id="newFeedTitle" placeholder="Mon flux personnalisé">
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="addNewFeed()">💾 Ajouter le flux</button>
        <button class="btn" onclick="closeModal('addFeedModal')">Annuler</button>
      </div>
    </div>
  </div>

  <!-- Modal Ajouter Thème -->
  <div id="addThemeModal" class="modal">
    <div class="modal-content">
      <span class="close" onclick="closeModal('addThemeModal')">&times;</span>
      <h2>➕ Ajouter un Thème</h2>
      
      <div class="form-group">
        <label for="newThemeName">Nom du thème:</label>
        <input type="text" id="newThemeName" placeholder="Technologie" required>
      </div>
      
      <div class="form-group">
        <label for="newThemeKeywords">Mots-clés (un par ligne):</label>
        <textarea id="newThemeKeywords" rows="6" placeholder="IA
robot
intelligence artificielle
machine learning"></textarea>
      </div>
      
      <div class="form-group">
        <label for="newThemeColor">Couleur:</label>
        <input type="color" id="newThemeColor" value="#3b82f6">
      </div>
      
      <div class="form-group">
        <label for="newThemeDescription">Description (optionnel):</label>
        <textarea id="newThemeDescription" rows="3" placeholder="Description du thème..."></textarea>
      </div>
      
      <div class="modal-actions">
        <button class="btn btn-primary" onclick="addNewTheme()">💾 Créer le thème</button>
        <button class="btn" onclick="closeModal('addThemeModal')">Annuler</button>
      </div>
    </div>
  </div>

  <script>
    // Configuration globale
    window.__API_BASE__ = "http://localhost:3000";
  </script>
  <script src="app.js"></script>
</body>
</html>