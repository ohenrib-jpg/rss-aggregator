<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgrÃ©gateur RSS ThÃ©matique + IA V.2.3</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@1.2.1"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <!-- Nouveau bandeau supÃ©rieur amÃ©liorÃ© -->
            <div class="header-main">
                <div class="header-title">
                    <h1>ğŸ“Š AgrÃ©gateur RSS ThÃ©matique</h1>
                    <div class="header-subtitle">
                        <span class="author">Olivier Henri B.</span>
                        <span class="version">V.2.3</span>
                    </div>
                </div>
                <div class="header-tagline">
                    Analyse de flux RSS par thÃ¨mes personnalisÃ©s - DÃ©tection avancÃ©e des tendances-DeepLearning (V.2) + IA
                </div>
            </div>

            <!-- Bandeau de dÃ©monstration amÃ©liorÃ© -->
            <div class="demo-banner" role="note" aria-live="polite">
                <div class="demo-icon">ğŸš€</div>
                <div class="demo-content">
                    <div class="demo-title">Application de dÃ©monstration</div>
                    <div class="demo-text">
                        Avec Ã  prÃ©sent la possibilitÃ© de stocker jusqu'Ã  1Go de donnÃ©es (Merci Ã  Render!). Attention : cela reste un serveur de test et de prÃ©sentation, il se rÃ©initialise automatiquement lorsque les quotas allouÃ©s sont atteints 
                    </div>
                    <div class="demo-api-info">
                        Testez la fonction IA avec une clÃ© API gratuite sur 
                        <a href="https://platform.openai.com/api-keys" target="_blank" rel="noopener noreferrer">OpenAI</a>
                    </div>
                </div>
            </div>
        </header>

        <div id="messageContainer"></div>

        <div class="status-bar">
            <div class="last-update" id="lastUpdate">
                Chargement...
            </div>
            <div class="refresh-controls">
                <div class="auto-refresh-indicator">
                    <span class="blink">ğŸ”„</span> Auto-actualisation
                </div>
                <button class="refresh" onclick="app.manualRefresh()" id="refreshBtn">
                    ğŸ”„ Actualiser
                </button>
            </div>
        </div>

        <!-- Barre d'export CORRIGÃ‰E - Une seule ligne alignÃ©e -->
        <div class="export-bar">
            <button class="export-btn json" onclick="app.exportData('json')">
                ğŸ“¥ Export JSON
            </button>
            <button class="export-btn csv" onclick="app.exportData('csv')">
                ğŸ“¥ Export CSV
            </button>
            <button class="export-btn stats" onclick="app.showLearningStats()">
                ğŸ“Š Stats Apprentissage
            </button>
            <button class="export-btn ia" onclick="app.runAIAnalysis()" id="iaAnalyzeBtn">
                ğŸ§  Analyse IA
            </button>
            <button class="export-btn ia-config" onclick="app.showIAApiKeyModal()" id="iaConfigBtn">
                âš™ï¸ Config IA
            </button>
        </div>

        <!-- Indicateur Corrections IA -->
        <div id="iaStatusBar" class="status-bar ia-status-bar" style="display: none;">
            <div class="auto-refresh-indicator">
                <span class="blink">ğŸ¤–</span> 
                <span id="iaStatusText">Corrections IA actives</span>
            </div>
            <div class="refresh-controls">
                <span id="iaLastCorrection">DerniÃ¨re correction: --</span>
                <button class="refresh" onclick="app.manualIACorrection()" id="iaCorrectBtn">
                    ğŸ”§ Corriger maintenant
                </button>
            </div>
        </div>

        <div class="stats-grid" id="statsGrid">
            <div class="loading">Chargement des donnÃ©es...</div>
        </div>

        <div class="tab-container">
            <div class="tabs">
                <div class="tab active" onclick="showTab('analysis', event)">ğŸ“ˆ Analyse</div>
                <div class="tab" onclick="showTab('trends', event)">ğŸ“Š Tendances</div>
                <div class="tab" onclick="showTab('metrics', event)">ğŸ¯ MÃ©triques</div>
                <div class="tab" onclick="showTab('sentiment', event)">ğŸ˜Š Sentiment</div>
                <div class="tab" onclick="showTab('learning', event)">ğŸ§  Apprentissage</div>
                <div class="tab" onclick="showTab('ia-corrections', event)">ğŸ¤– Corrections IA</div>
                <div class="tab" onclick="showTab('feeds', event)">ğŸ“° Flux RSS</div>
                <div class="tab" onclick="showTab('themes', event)">ğŸ¨ ThÃ¨mes</div>
                <div class="tab" onclick="showTab('articles', event)">ğŸ“„ Articles</div>
            </div>

            <!-- Onglet Analyse Principale -->
            <div id="analysisTab" class="tab-content active">
                <div class="dashboard">
                    <div class="card">
                        <h3>
                            RÃ©partition par ThÃ¨me 
                            <span class="info-icon" title="Seuls les thÃ¨mes ayant au moins une correspondance sont affichÃ©s">â„¹ï¸</span>
                        </h3>
                        <canvas id="themeChart" height="250"></canvas>
                    </div>
                    <div class="card">
                        <h3>Ã‰volution Temporelle</h3>
                        
                        <!-- ContrÃ´les avancÃ©s du graphique -->
                        <div class="chart-controls-bar">
                            <div class="control-group">
                                <label>Ã‰chelle temporelle :</label>
                                <select id="timeScale" onchange="app.chartManager.changeTimeScale(this.value)">
                                    <option value="day">Par jour</option>
                                    <option value="week" selected>Par semaine</option>
                                    <option value="month">Par mois</option>
                                    <option value="quarter">Par trimestre</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <label>AgrÃ©gation :</label>
                                <select id="aggregationType" onchange="app.chartManager.changeAggregation(this.value)">
                                    <option value="count" selected>Nombre d'articles</option>
                                    <option value="percentage">Pourcentage</option>
                                    <option value="movingAverage">Moyenne mobile (7j)</option>
                                </select>
                            </div>
                            
                            <div class="control-group">
                                <button onclick="app.chartManager.toggleMinorThemes()" class="toggle-minor-btn" id="toggleMinorBtn">
                                    ğŸ‘ï¸ Masquer thÃ¨mes mineurs
                                </button>
                                <button onclick="app.chartManager.exportChartData()" class="export-data-btn">
                                    ğŸ“¥ Exporter donnÃ©es
                                </button>
                            </div>
                        </div>

                        <!-- SÃ©lecteur de thÃ¨mes injectÃ© ici -->
                        <div id="themeSelectorContainer"></div>
                        
                        <div class="chart-container">
                            <canvas id="timelineChart" height="400"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Tendances -->
            <div id="trendsTab" class="tab-content">
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>ğŸ“ˆ Ã‰volution des ThÃ¨mes</h3>
                        <div id="trendsTable" class="trends-table">
                            <div class="loading">Calcul des tendances...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card">
                        <h3>ğŸ”¼ ThÃ¨mes en Croissance</h3>
                        <div id="growthThemes" class="trends-list">
                            <div class="loading">Analyse en cours...</div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>ğŸ”½ ThÃ¨mes en Baisse</h3>
                        <div id="declineThemes" class="trends-list">
                            <div class="loading">Analyse en cours...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet MÃ©triques AvancÃ©es -->
            <div id="metricsTab" class="tab-content">
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>ğŸ¯ EfficacitÃ© des Mots-ClÃ©s</h3>
                        <div id="keywordMetrics" class="metrics-table">
                            <div class="loading">Analyse des mots-clÃ©s...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card">
                        <h3>ğŸ”„ CorrÃ©lations entre ThÃ¨mes</h3>
                        <div id="correlationsMatrix" class="correlations-matrix">
                            <div class="loading">Calcul des corrÃ©lations...</div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>ğŸ“… Analyse SaisonniÃ¨re</h3>
                        <div id="seasonalityAnalysis" class="seasonality-chart">
                            <div class="loading">Analyse saisonniÃ¨re...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Analyse de Sentiment -->
            <div id="sentimentTab" class="tab-content">
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>ğŸ“Š AperÃ§u du Sentiment Global</h3>
                        <div id="sentimentOverview">
                            <div class="loading">Analyse de sentiment en cours...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>ğŸ¨ Ã‰volution des Sentiments par ThÃ¨mes</h3>
                        <div id="sentimentByTheme">
                            <div class="loading">Calcul des sentiments par thÃ¨me...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card">
                        <h3>ğŸ˜Š Articles Positifs</h3>
                        <div id="positiveArticles" class="articles-list">
                            <div class="loading">Chargement des articles positifs...</div>
                        </div>
                    </div>
                    <div class="card">
                        <h3>ğŸ˜ Articles NÃ©gatifs</h3>
                        <div id="negativeArticles" class="articles-list">
                            <div class="loading">Chargement des articles nÃ©gatifs...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ONGLET : Apprentissage -->
            <div id="learningTab" class="tab-content">
                <div class="dashboard">
                    <div class="card">
                        <h3>ğŸ§  Statistiques d'Apprentissage</h3>
                        <div id="learningStats">
                            <div class="loading">Chargement des statistiques...</div>
                        </div>
                        <div class="learning-actions">
                            <button onclick="app.refreshLearningStats()" class="refresh">ğŸ”„ Actualiser</button>
                            <button onclick="app.resetLearning()" class="delete">ğŸ—‘ï¸ RÃ©initialiser</button>
                        </div>
                    </div>
                    <div class="card">
                        <h3>ğŸ“ Apprentissage Manuel</h3>
                        <div class="learning-form">
                            <textarea id="learningText" placeholder="Entrez le texte Ã  analyser..." rows="4"></textarea>
                            <div class="score-slider">
                                <label>Score attendu: <span id="scoreValue">0.00</span></label>
                                <input type="range" id="expectedScore" min="-1" max="1" step="0.1" value="0">
                                <div class="score-labels">
                                    <span>NÃ©gatif (-1)</span>
                                    <span>Neutre (0)</span>
                                    <span>Positif (+1)</span>
                                </div>
                            </div>
                            <button onclick="app.learnFromCorrection()" class="learn-btn">ğŸ“ Apprendre</button>
                            <div id="learningResult" class="learning-result"></div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>ğŸ“ˆ Mots Appris RÃ©cemment</h3>
                        <div id="learnedWords" class="learned-words">
                            <div class="loading">Chargement des mots appris...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ONGLET : Corrections IA -->
            <div id="ia-correctionsTab" class="tab-content">
                <div class="dashboard">
                    <div class="card">
                        <h3>ğŸ¤– Ã‰tat des Corrections IA</h3>
                        <div id="iaStatusOverview">
                            <div class="loading">Chargement des corrections IA...</div>
                        </div>
                        <div class="learning-actions">
                            <button onclick="app.manualIACorrection()" class="refresh">ğŸ”§ Correction Manuelle</button>
                            <button onclick="app.configureIA()" class="learn-btn">âš™ï¸ Configuration IA</button>
                        </div>
                    </div>
                    <div class="card">
                        <h3>ğŸ“ˆ Statistiques des Corrections</h3>
                        <div id="iaCorrectionsStats">
                            <div class="loading">Calcul des statistiques...</div>
                        </div>
                    </div>
                </div>
                <div class="dashboard">
                    <div class="card full-width">
                        <h3>ğŸ“‹ Historique des Corrections</h3>
                        <div id="iaCorrectionsHistory" class="articles-list">
                            <div class="loading">Chargement de l'historique...</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Onglet Flux RSS -->
            <div id="feedsTab" class="tab-content">
                <div class="card">
                    <h3>â• Ajouter un Flux RSS</h3>
                    <div class="form-group">
                        <input type="url" id="feedUrl" placeholder="https://exemple.com/flux.rss" required>
                        <button onclick="addFeed()">Ajouter le flux</button>
                    </div>
                    <small>Exemples: https://www.lemonde.fr/rss/une.xml, https://www.liberation.fr/arc/outboundfeeds/rss-all/collection/accueil-une/</small>
                </div>
                <div class="card">
                    <h3>ğŸ“‹ Mes Flux RSS</h3>
                    <div id="feedsList">
                        <div class="loading">Chargement des flux...</div>
                    </div>
                </div>
            </div>

            <!-- Onglet ThÃ¨mes -->
            <div id="themesTab" class="tab-content">
                <div class="card">
                    <h3>ğŸ¨ CrÃ©er un ThÃ¨me</h3>
                    <div class="form-group">
                        <input type="text" id="themeName" placeholder="Nom du thÃ¨me (ex: Joie)" required>
                        <textarea id="themeKeywords" placeholder="Mots-clÃ©s (sÃ©parÃ©s par des virgules): joie, bonheur, succÃ¨s, rÃ©ussite" rows="3" required></textarea>
                        
                        <div class="color-picker-section">
                            <label for="themeColor">Couleur du thÃ¨me :</label>
                            <div class="color-picker-container">
                                <input type="color" id="themeColor" value="#6366f1" class="color-input">
                                <div class="color-presets">
                                    <div class="color-preset" style="background-color: #6366f1;" data-color="#6366f1"></div>
                                    <div class="color-preset" style="background-color: #10b981;" data-color="#10b981"></div>
                                    <div class="color-preset" style="background-color: #f59e0b;" data-color="#f59e0b"></div>
                                    <div class="color-preset" style="background-color: #ef4444;" data-color="#ef4444"></div>
                                    <div class="color-preset" style="background-color: #8b5cf6;" data-color="#8b5cf6"></div>
                                    <div class="color-preset" style="background-color: #06b6d4;" data-color="#06b6d4"></div>
                                    <div class="color-preset" style="background-color: #84cc16;" data-color="#84cc16"></div>
                                    <div class="color-preset" style="background-color: #f97316;" data-color="#f97316"></div>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="addTheme()">CrÃ©er le thÃ¨me</button>
                    </div>
                </div>
                <div class="card">
                    <h3>ğŸ¨ Mes ThÃ¨mes</h3>
                    <div id="themesList">
                        <div class="loading">Chargement des thÃ¨mes...</div>
                    </div>
                </div>
            </div>

            <!-- Onglet Articles -->
            <div id="articlesTab" class="tab-content">
                <div class="card">
                    <h3>ğŸ“„ Derniers Articles</h3>
                    <div class="articles-list" id="articlesList">
                        <div class="loading">Chargement des articles...</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal pour les statistiques d'apprentissage -->
    <div id="learningStatsModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h3>ğŸ“Š Statistiques d'Apprentissage</h3>
            <div id="modalLearningStats">
                <div class="loading">Chargement...</div>
            </div>
        </div>
    </div>

    <!-- Modal pour la configuration IA -->
    <div id="iaApiKeyModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="app.closeIAApiKeyModal()">&times;</span>
            <h3>ğŸ”‘ Configuration de l'IA</h3>
            <div class="api-key-form">
                <div class="form-group">
                    <label for="iaApiKey">ClÃ© API IA :</label>
                    <input type="password" id="iaApiKey" placeholder="sk-..." class="api-key-input">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="iaAutoCorrection" checked>
                        Corrections automatiques toutes les heures
                    </label>
                </div>
                
                <div class="api-key-info">
                    <p><strong>FonctionnalitÃ©s activÃ©es :</strong></p>
                    <ul>
                        <li>âœ… Correction des scores de sentiment</li>
                        <li>âœ… DÃ©tection des faux positifs/nÃ©gatifs</li>
                        <li>âœ… Analyse contextuelle avancÃ©e</li>
                        <li>âœ… VÃ©rification externe par scraping</li>
                        <li>âœ… GÃ©nÃ©ration de rapports PDF</li>
                    </ul>
                </div>
                
                <div class="api-key-actions">
                    <button onclick="app.saveIAApiKey()" class="save-btn">ğŸ’¾ Enregistrer</button>
                    <button onclick="app.disableIA()" class="delete">ğŸ—‘ï¸ DÃ©sactiver IA</button>
                    <button onclick="app.closeIAApiKeyModal()" class="cancel-btn">Annuler</button>
                </div>
                
                <small class="api-key-note">
                    La clÃ© API est stockÃ©e localement dans votre navigateur et utilisÃ©e uniquement pour les corrections IA.
                </small>
            </div>
        </div>
    </div>

    <script src="chart-manager.js"></script>
    <script src="app.js"></script>

    <script>
        // Script d'initialisation des prÃ©sÃ©lecteurs de couleurs
        document.addEventListener('DOMContentLoaded', function() {
            // Initialiser les prÃ©sÃ©lecteurs de couleurs
            const colorPresets = document.querySelectorAll('.color-preset');
            colorPresets.forEach(preset => {
                preset.addEventListener('click', function() {
                    const color = this.getAttribute('data-color');
                    document.getElementById('themeColor').value = color;
                    
                    // Mettre Ã  jour la classe active
                    colorPresets.forEach(p => p.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Initialiser le slider de score
            const scoreSlider = document.getElementById('expectedScore');
            if (scoreSlider) {
                scoreSlider.addEventListener('input', function() {
                    document.getElementById('scoreValue').textContent = parseFloat(this.value).toFixed(2);
                });
            }
            
            // Fermeture des modals
            document.querySelectorAll('.modal .close').forEach(closeBtn => {
                closeBtn.addEventListener('click', function() {
                    this.closest('.modal').style.display = 'none';
                });
            });
            
            // Fermeture des modals en cliquant Ã  l'extÃ©rieur
            window.addEventListener('click', function(event) {
                document.querySelectorAll('.modal').forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        });
    </script>
</body>
</html>